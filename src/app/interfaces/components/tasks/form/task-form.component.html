<p-dialog 
    [header]="formTitle" 
    [(visible)]="visible" 
    [modal]="true" 
    [closable]="true" 
    [draggable]="false"
    [resizable]="false" 
    [style]="{ width: '500px' }" 
    (onHide)="onCancel()" 
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
    role="dialog"
    [attr.aria-labelledby]="taskToEdit?.id ? 'edit-task-dialog-title' : 'create-task-dialog-title'"
    aria-describedby="task-form-description"
    [focusOnShow]="true">

    <ng-template pTemplate="header">
        <h2 [id]="taskToEdit?.id ? 'edit-task-dialog-title' : 'create-task-dialog-title'" class="h5 mb-0">
            {{ formTitle }}
        </h2>
    </ng-template>

    <p class="visually-hidden" id="task-form-description">
        {{ taskToEdit?.id ? 'Edit the details of your task below' : 'Fill in the form below to create a new task' }}
    </p>

    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="d-flex flex-column gap-3" novalidate aria-label="Task form">
        <div class="d-flex flex-column gap-2">
            <label for="task-title" class="form-label fw-medium text-dark">
                <span>Title</span>
                <span class="text-danger" aria-label="required">*</span>
            </label>
            <input 
                id="task-title" 
                type="text" 
                pInputText 
                formControlName="title" 
                placeholder="Enter task title"
                class="form-control" 
                [class.is-invalid]="isFieldInvalid('title')" 
                [attr.aria-describedby]="isFieldInvalid('title') ? 'task-title-error' : 'task-title-hint'"
                [attr.aria-invalid]="isFieldInvalid('title')"
                aria-required="true"
                maxlength="100" />
            <small id="task-title-hint" class="text-muted" *ngIf="!isFieldInvalid('title')">
                Enter a descriptive title for your task
            </small>
            <small *ngIf="isFieldInvalid('title')" class="text-danger" id="task-title-error" role="alert" aria-live="polite">
                {{ getFieldError('title') }}
            </small>
        </div>

        <div class="d-flex flex-column gap-2">
            <label for="task-description" class="form-label fw-medium text-dark">
                Description <span class="text-muted">(optional)</span>
            </label>
            <textarea 
                id="task-description" 
                pInputTextarea 
                formControlName="description"
                placeholder="Enter task description" 
                rows="4" 
                class="form-control"
                [class.is-invalid]="isFieldInvalid('description')" 
                [attr.aria-describedby]="isFieldInvalid('description') ? 'task-description-error' : 'task-description-hint'"
                [attr.aria-invalid]="isFieldInvalid('description')"
                maxlength="500"></textarea>
            <small id="task-description-hint" class="text-muted" *ngIf="!isFieldInvalid('description')">
                Add additional details about your task
            </small>
            <small *ngIf="isFieldInvalid('description')" class="text-danger" id="task-description-error" role="alert" aria-live="polite">
                {{ getFieldError('description') }}
            </small>
        </div>

        <div class="d-flex gap-2 justify-content-end" role="group" aria-label="Form actions">
            <p-button 
                type="submit" 
                [label]="submitButtonLabel" 
                [disabled]="taskForm.invalid"
                [attr.aria-label]="taskToEdit?.id ? 'Save changes to task' : 'Create new task'"></p-button>
            <p-button 
                type="button" 
                [label]="cancelButtonLabel" 
                severity="secondary" 
                (onClick)="onCancel()"
                aria-label="Cancel and close dialog"></p-button>
        </div>
    </form>
</p-dialog>